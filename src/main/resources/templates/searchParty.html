<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head th:replace="fragments.html :: headers(~{::title}, ~{::link}, ~{::script}, ~{::style})">
    <title>파티찾기</title>
    <link>
    <script src="/js/searchPartyJs.js"></script>
    <style></style>
</head>

<!--2022-03-24 강경민
    검색 페이지 제작-->
<body>
    <nav th:replace="fragments.html :: navigator(0)"></nav>

    <div class="container" style="padding-top: 90px">
        <div>
            <form class="input-group has-validation pt-5 pb-3">
                <input type="search" class="form-control" placeholder="search" aria-label="Search">
                <button type="button" class="input-group-text">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                        <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                    </svg>
                </button>
            </form>
        </div>
        <div>
            검색결과(<span id="searchNum" th:text="${#lists.size(parties)}">0</span>건)
        </div>
        <hr>

        <th:block th:each="num : ${#numbers.sequence(0, 5)}">
            <div th:object="${parties[num]}">
                <div class="row g-0 border rounded overflow-hidden flex-md-row mb-2 shadow-sm position-relative" style="height: 200px">
                    <div class="col-2 d-none d-lg-block text-center align-content-center bg-light">
                        <img src="/img/baeminLogo.PNG" alt="배달매체" width="200" height="200">
                    </div>
                    <div class="col-10">
                        <div class="row px-4">
                            <h3 class="mt-1 mb-0 overflow-hidden" th:text="${parties[num].title}" style="height: 30px;">제목</h3>
                            <hr class="mt-2">
                            <strong><div class="my-2 text-muted" th:text="${parties[num].restaurant}">주문한 점포명</div></strong>
                            <strong class="d-inline-block my-2 text-muted" th:text="${parties[num].pickUpLocation} + ' ' + ${parties[num].pickUpLocationDetail}">수령 장소</strong>
                            <div class="col-6 px-3 my-2 d-flex flex-column position-static">
                                <!--                            <strong class="d-inline-block mb-2 text-success">수령 장소</strong>-->
                                <div class="mb-1 text-muted" th:text="'[' + ${parties[num].limitTime} + ']까지 모집 중'">모집 시간</div>
                            </div>
                            <div class="col-6 px-3 my-2 d-flex flex-column position-static">
                                <!--                            <a href="#" class="stretched-link">모집인원</a>-->
                                <strong><a th:href="@{/partyDetails}" th:text="${parties[num].membersNum} + '/' + ${parties[num].maxMemberNum} + '명'" class="stretched-link text-decoration-none text-muted">모집 인원</a></strong>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </th:block>

        <div class="text-center align-items-center pt-5">
            <button type="button" id="toPreviewPage" class="btn btn-primary" onclick="previewPage()" style="position: relative; width: 25px; height: 25px; margin-right: 30px">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-caret-left-fill" viewBox="0 0 16 16" style="position: absolute; right: 4px; top: 3px">
                    <path d="m3.86 8.753 5.482 4.796c.646.566 1.658.106 1.658-.753V3.204a1 1 0 0 0-1.659-.753l-5.48 4.796a1 1 0 0 0 0 1.506z"></path>
                </svg>
            </button>
            <span id="currentPage" th:value="1">1</span>
            <span>/</span>
            <span th:text="${#lists.size(parties)/6 + 1}"></span>
            <button type="button" id="toNextPage" class="btn btn-primary" onclick="nextPage()" style="position: relative; width: 25px; height: 25px; margin-left: 30px">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-caret-right-fill" viewBox="0 0 16 16" style="position: absolute; left: 4px; top: 3px">
                    <path d="m12.14 8.753-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z"></path>
                </svg>
            </button>
        </div>
        <div class="text-center pt-2 pb-5">
            <span>총 (</span>
            <span id="totalPage" th:text="${#lists.size(parties)/6 + 1}"></span>
            <span>)페이지</span>
        </div>
    </div>

    <div th:insert="fragments.html :: test3('param1')" class="py-5 text-center" id="testFra">
        <span id="testFraIn">hihi</span>
    </div>

    <button type="button" id="testFraBtn" style="width: 100px; height: 100px"></button>

    <select id="testFraBtn2" style="margin-bottom: 100px">
        <option>Content 1</option>
        <option>Content 2</option>
    </select>


    <script th:inline="javascript">
        function testFuc() {
            var testTag = document.getElementById("testFra");
            // $('#testFra').load("/testFragment");
            //ajax 써서 fragment 호출해줍니다.
            // testTag.
        }

        var httpRequest;

        document.getElementById("testFraBtn").addEventListener('click', () => {

            console.log("listenerClicked");
            var testTag = document.getElementById("testFra");
            console.log(testTag.innerHTML);
            var reqJson = new Object();
            reqJson.getTestFra = 100;
            httpRequest = new XMLHttpRequest();

            httpRequest.onreadystatechange = () => {
                //readyState가 Done이고 응답 값이 200일 때
                if (httpRequest.readyState === XMLHttpRequest.DONE) {
                    if (httpRequest.status === 200) {
                        var result = httpRequest.response;
                        console.log(result);
                        document.getElementById("testFraIn").replaceWith("result");
                    } else {
                        alert('ajax Request Error!');
                    }
                }
            };
            //Post 방식, 응답은 json, 요청헤더 json
            httpRequest.open('POST', '/testFragment', true);
            httpRequest.responseType = "text";
            httpRequest.setRequestHeader('Content-Type', 'application/json');
            httpRequest.send(JSON.stringify(reqJson));
        });
    </script>

    <script>
        // $(document).ready(function () {
        //
        //     //call function when page is loaded
        //     getContent();
        //
        //     //set on change listener
        //     $('#testFraBtn2').change(getContent);
        //
        //     function getContent() {
        //
        //         //create url to request fragment
        //         var url = /testFragment;
        //
        //         //load fragment and replace content
        //         $('#testFraIn').load(url);
        //     }
        // })
    </script>

    <!-- JavaScript Bundle with Popper -->
<!--    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>-->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous">
    </script>
</body>
</html>