># 배달비 분담 서비스
<br/>
배달의 민족, 요기요 등 배달 중계 서비스를 이용하여 음식을 주문할 때 여러 명이 한 번에 주문함으로써 배달비를 적게 낼 수 있게 만든 배달비 분담 플랫폼입니다.<br/><br/>

- 본 페이지는 실제 서비스를 제공하지 않습니다. 결제 시 사용한 금액은 매일 24:00시에 환불됩니다.<br/>
- 또한 PC환경에 최적화되어 있으며 모바일 환경에서는 일부 제약이 있을 수 있습니다.
<br/><br/><br/><br/>

**목차**
- [사이트 바로가기](#사이트-바로가기)
- [사용 기술](#사용-기술)
- [도메인](#도메인)
- [페이지 설명](#페이지-설명)
	- [메인 페이지](#메인 페이지)
	- [로그인 및 회원가입](#로그인 및 회원가입)
	- [모집글 검색](#모집글 검색)
	- [파티 상세보기 및 관리](#파티 상세보기 및 관리)
	- [파티 가입 및 결제](#파티 가입 및 결제)
	- [모집글 등록](#모집글 등록)
	- [회원 정보](#회원 정보)
		- [파티 관리 탭](#파티 관리 탭)
		- [알림 탭](#알림 탭)
		- [사용자 정보 탭](#용자 정보 탭)

<br/><br/><br/><br/>


> # 사이트 바로가기

바로가기: [https://www.project-km.link](https://www.project-km.link)

&nbsp;**테스트용 계정**
 | 아이디 | testAccount |
 |--|--|
 | 비밀번호 | testAccount! |


<br/><br/><br/><br/>
> # 사용 기술

- `java` 
- `Spring Boot` `Spring Security` `Spring Data Jpa` 
- `Thymeleaf` `Javascript` 
- `Bootstrap` 
- `Mysql` 
- `AWS ec2` `AWS rds` `AWS route53` 
<br/><br/><br/><br/>

> # 도메인

![Untitled (27)](https://user-images.githubusercontent.com/74872542/193759676-2e8880a4-1d46-43c9-a7d8-2562c7bf7481.png)

- Member와 Party는 다대다 관계입니다. 실제 구현 단계에서는 확장성을 위해 중간 엔티티를 하나 더 만든 후 일대다, 다대일 관계로 바꾸어서 구현하였습니다.
- 모든 엔티티는 생성시간, 수정시간 기록을 위해 BaseEntitiy를 상속받습니다.
- Party에서 새로운 변화가 생기면 PartyMessage가 생성되고 파티에 소속된 Member는 PartyMessage를 확인할 수 있습니다.
- Member의 활동은 NotificationLog를 통해 기록됩니다.
- Member가 결제한 내용은 Payments로 기록되고 환불 시에 검증을 위해 사용됩니다.
<br/><br/><br/><br/>

> # 페이지 설명

> ## 메인 페이지

https://user-images.githubusercontent.com/74872542/193761471-5ca0530a-ebcf-4f1d-98f9-3909e85338de.mp4

- 사용자에게 홈페이지가 어떤 서비스를 제공하는지 알려주고 사용법을 쉽게 알려주기 위한 페이지입니다.
- 총 4개의 섹션으로 구성되어 있으며 첫 번째, 두 번째 섹션은 서비스에 대한 설명이 적혀있고 세 번째, 네 번째 섹션은 사용하는 방법을 설명합니다.
- 사용자가 아래에 추가 설명이 있다는 걸 인지시키기 위해 섹션 사이마다 10초마다 한 번씩 깜빡이는 화살표를 삽입했습니다.
- 서비스를 이용하기 위해선 로그인이 필요합니다. 로그인이 안 되어 있을 때 서비스를 이용하는 버튼을 클릭하면 로그인 화면으로 이동합니다.

<br/>

- 내비게이션 바는 자주 쓰이는 기능이므로 타임리프로 공통 로직을 fragments.html 파일로 묶어서 중복을 제거했습니다.
- 타임리프로 로그인 여부를 검사하고 내비게이션 바에 나타나는 요소가 달라지게 설정하였습니다.

<br/><br/><br/><br/>

> ## 로그인 및 회원가입

![로그인2_편집본](https://user-images.githubusercontent.com/74872542/193762502-798646fd-b947-46c6-ba56-1e831f0c2765.gif)
- 아이디나 비밀번호가 매치가 되지 않는다면 오류 문구와 함께 로그인이 실패합니다.
- 계정이 없다면 회원가입을 클릭해서 새로운 계정을 생성할 수 있습니다.

<br/><br/><br/><br/>

![Untitled (28)](https://user-images.githubusercontent.com/74872542/193762777-7b21bf75-5b99-49f0-a9d8-207112361ab3.png)
- 인증이 실패했다면 스프링 시큐리티에서 제공하는 SimpleUrlAuthenticationFailureHandler를 상속받는 핸들러로 인증 실패 원인을 사용자에게 출력하도록 만들었습니다.

<br/><br/><br/><br/>

![Untitled (29)](https://user-images.githubusercontent.com/74872542/193763294-522fd87a-97b9-485b-a1ed-dd72469d5bfd.png)
- 여러 개의 계정을 무한히 생성하는 걸 막기 위해 동일 휴대전화 번호로 하나의 계정만 생성할 수 있게 만들었으며 문자 메시지를 전송하기 위해 Twilio 사의 메시지 API를 사용하였습니다.
- 문자 전송 버튼 클릭 시 6자리의 인증번호가 생성된 후 입력된 휴대전화 번호로 전송되며 세션에도 3분의 유효기간을 가진 형태로 저장됩니다.
- 문자 전송 버튼의 연타를 방지하기 위해 버튼 클릭 후 10초 뒤에 다시 누를 수 있고 남은 시간은 버튼에 표시됩니다.
- 인증하기를 클릭해도 페이지가 새로고침 되서 입력정보가 없어지지 않도록 자바스크립트 ajax로 처리하였습니다.
- 비밀번호는 암호화 후 저장합니다. 로그인 시에도 사용자가 입력한 비밀번호를 다시 암호화 결과와 DB에 저장된 값의 일치 여부만 비교하는 방식으로 개발자도 계정을 탈취하기 어렵게 하였습니다.

<br/><br/><br/><br/>

![Untitled (30)](https://user-images.githubusercontent.com/74872542/193763320-3c0e6e8a-2b21-4ace-9f12-c83341da5048.png)
- 아이디 중복, 휴대전화 인증 실패, 비밀번호 확인 절차 실패 등의 문제가 발생하면 오류가 출력됩니다.
- 등록하기 버튼 클릭 시 아이디 중복, 인증번호 일치, 비밀번호 일치 여부를 다시 한번 확인하며 이상이 없다면 회원 정보를 저장 후 로그인 페이지로 이동합니다.

<br/><br/><br/><br/>

> ## 모집글 검색

![파티검색 페이지이동](https://user-images.githubusercontent.com/74872542/193773924-a7a65138-1a87-4446-a736-14326d4ad19c.gif)
- 검색 화면입니다. 상단 내비게이션 바에서 검색 탭 클릭 시 진입할 수 있습니다.
- 회원들이 올린 모집 글들을 확인할 수 있으며 해당 항목을 클릭 시 자세한 내용을 확인하는 상세페이지로 이동합니다.
- 회원 가입 후 사용자가 기본 픽업 장소를 입력해놨다면 모집 글은 거리가 가까운 순으로 정렬되어서 출력됩니다. (기본 픽업 장소 입력이 안 되어있다면 거리는 표시되지 않습니다.)
- 특정 위치와 위치 사이의 거리를 측정하기 위해선 사용자가 원하는 위치의 정확한 주소를 찾아주는 기능과 찾은 주소의 위도와 경도 정보가 필요합니다. 해당 정보를 얻기 위해서 Daum 우편번호 API와 카카오 맵 API를 사용했습니다.

<br/><br/><br/><br/>

![파티 검색2](https://user-images.githubusercontent.com/74872542/193773965-298ba691-a9b4-47bd-a383-2ec98db9af3f.gif)
- 검색을 통해 원하는 결과만 볼 수 있습니다.
- 모집 중인 파티 중에 제목, 픽업 장소, 음식점, 소개에 검색 키워드가 포함된 결과만 보여줍니다.
- 한 페이지에 최대 6개의 모집 글이 표시되며 하단의 페이지 이동 버튼 클릭 시 다음 검색 결과를 볼 수 있습니다.

<br/><br/><br/><br/>

> ## 파티 상세보기 및 관리

![Untitled (33)](https://user-images.githubusercontent.com/74872542/193764698-96a6197b-ea73-49f0-adce-75746b63746c.png)

![Untitled (34)](https://user-images.githubusercontent.com/74872542/193764711-979e580a-5c0c-4f89-af78-80720936d1a1.png)
- 파티 상세보기 페이지입니다.
- 파티에 이미 참여했거나 모집 인원에 여유가 없다면 가입하기 버튼이 비활성화됩니다.
- 모집 인원이 꽉 찼거나 모집 시간이 끝났다면 파티 상태는 모집 완료 상태로 변경됩니다.
- 파티원이 되었다면 파티 메시지를 볼 수 있습니다. 파티원 참가, 파티 상태 변경 등 변화가 있을 때마다 파티 메시지가 발생하며 파티원들에게 알림을 전송합니다.
- 음식은 파티장이 주문하며 주문 현황을 주문 완료, 배달 완료 등으로 파티 상태를 변경함으로써 파티원에게 알려줄 수 있습니다.

<br/><br/><br/><br/>

> ## 파티 가입 및 결제

![파티 가입](https://user-images.githubusercontent.com/74872542/193773955-99af65d0-13a3-4b6c-ac0a-e59df2ab4b89.gif)
- 파티 가입이 가능한 상태에서 가입하기 버튼 클릭 시 요청사항, 주문 금액을 입력할 수 있는 모달창이 발생합니다.
- 배달비는 파티원이 수정하는 것이 불가능하며 파티장이 올린 금액을 N명으로 나눈 값입니다.

<br/><br/><br/><br/>

![Untitled (36)](https://user-images.githubusercontent.com/74872542/193775020-322542ee-a825-4e74-97c4-cf1bd8793fb6.png)
- 모달창에서 제출 및 결제 클릭 시 결제 창이 발생합니다.
- 결제는 아임포트 API를 이용해서 구현하였습니다.
- 결제가 완료 후 파티장에게 메시지가 전송되는데 만약 파티장이 거절하면 결제된 금액은 다시 환불됩니다.

<br/><br/><br/><br/>

> ## 모집글 등록

![모집글 위치 검색 편집본](https://user-images.githubusercontent.com/74872542/193773978-861488fa-9a3d-4e89-986d-7a1e8ddf5592.gif)
![모집글 날짜조작 편집본](https://user-images.githubusercontent.com/74872542/193774000-850280d5-92de-4aa2-a9aa-22cb88d07adc.gif)
- 원하는 파티가 없다면 직접 모집 글을 등록할 수 있습니다.
- 수령 장소 항목에서 검색 버튼 클릭 시 지도와 함께 정확한 주소를 검색할 수 있도록 daum 우편번호 API를 이용하였습니다.
- 한 항목에서 여러 개의 오류가 발생하더라도 오류 내용이 하나씩 출력되도록 검증기를 따로 만들었습니다.
- 60초마다 현재 시간과 모집 종료 시간을 비교합니다. 모집 종료 시간이 지났다면 파티 상태를 모집 완료로 바꾸고 파티원 모집이 비활성화됩니다.

<br/><br/><br/><br/>

> ## 회원 정보
> ### 파티 관리 탭
![파티관리탭](https://user-images.githubusercontent.com/74872542/193779075-cb6f29e8-70ac-4e3f-bc09-f09a77210340.gif)
- 상단 네비게이션 바의 사용자 아이콘을 클릭하면 회원 정보 페이지로 이동할 수 있습니다.
- 아직 음식을 받지 못한 주문은 진행중인 파티로, 배달 완료된 주문은 만료 파티로 분류됩니다.

<br/><br/><br/><br/>

> ### 알림 탭
![알림탭](https://user-images.githubusercontent.com/74872542/193779097-e05ccfa8-aa52-4634-80e1-44624f35ccba.gif)
- 사용자가 기록되야 할 동작을 할 때마다 알림이 생성됩니다. 
- 생성된 알림은 NotificationLog 테이블에 저장되며 ReadStatus로 읽기 상태를 확인합니다.
- 알림은 상단 네비게이션 바의 알림 아이콘과 사용자 정보의 알림 탭에서 확인 가능합니다. 
- 알림 클릭 시 NotificationLog에 저장된 url을 참조해서 작업이 필요한 페이지로 이동합니다.

<br/><br/><br/><br/>

> ### 사용자 정보 탭
![사용자정보탭](https://user-images.githubusercontent.com/74872542/193779088-36166e96-58a6-4aff-8154-9387c69c8b96.gif)
- 사용자의 정보가 표시됩니다.
- 기본 픽업 장소 설정 및 변경이 가능하며 설정 후엔 모집글 검색 시에 검색 결과를 거리순으로 보여줍니다.













